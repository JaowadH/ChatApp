<%- include('../partials/header') %>
<script src="/frontend.js"></script>

<!-- Expose username for frontend JS -->
<script>
  window.username = "<%= username %>";
</script>

<!-- Chat container -->
<div class="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300 flex flex-col md:flex-row">

  <!-- Sidebar: Online Users -->
  <aside class="bg-gray-100 dark:bg-gray-800 w-full md:w-64 p-4 border-b md:border-r border-gray-300 dark:border-gray-700">
    <h2 class="text-lg font-semibold text-blue-500 mb-4">Online Users</h2>
    <ul id="online-users" class="space-y-2 text-sm">
      <!-- Will be filled dynamically -->
    </ul>
    <p class="mt-4 text-gray-600 dark:text-gray-400 text-xs">Total: <span id="user-count">0</span></p>
  </aside>

  <!-- Chat Area -->
  <main class="flex-1 flex flex-col h-[calc(100vh-4rem)] md:h-screen">

    <!-- Top Bar with Logout -->
    <div class="flex justify-between items-center p-4 border-b border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
      <h2 class="text-lg font-semibold text-blue-500">Chat</h2>
      <form action="/logout" method="POST">
        <button class="text-sm bg-red-500 hover:bg-red-600 text-white px-4 py-1 rounded-lg">Logout</button>
      </form>
    </div>

    <!-- Messages Feed -->
    <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4">
      <!-- Message bubbles will be injected dynamically by JS -->
    </div>

    <!-- Typing Status -->
    <div id="typing-status" class="text-sm text-gray-500 dark:text-gray-400 px-4 py-1 h-6">
      <!-- e.g., "Alex is typing..." -->
    </div>

    <!-- Chat Input -->
    <form id="chat-form" class="flex p-4 border-t border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900">
      <input
        id="chat-input"
        type="text"
        placeholder="Type your message..."
        autocomplete="off"
        class="flex-1 px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <button type="submit" class="ml-3 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition">
        Send
      </button>
    </form>
  </main>
</div>

<%- include('../partials/footer') %>
